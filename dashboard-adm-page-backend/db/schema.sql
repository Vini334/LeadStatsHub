--------------------------------------------------------
--  Arquivo criado - sexta-feira-outubro-03-2025   
--------------------------------------------------------
--------------------------------------------------------
--  DDL for Sequence ALERTS_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "RM563326"."ALERTS_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 4 NOCACHE  NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence INTERACTION_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "RM563326"."INTERACTION_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 16 NOCACHE  NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence POST_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "RM563326"."POST_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 16 NOCACHE  NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence USER_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "RM563326"."USER_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 11 NOCACHE  NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Table ENGAGEMENT_WEEKLY
--------------------------------------------------------

  CREATE TABLE "RM563326"."ENGAGEMENT_WEEKLY" 
   (	"WEEK_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE , 
	"START_DATE" DATE, 
	"END_DATE" DATE, 
	"TOTAL_LIKES" NUMBER DEFAULT 0, 
	"TOTAL_COMMENTS" NUMBER DEFAULT 0, 
	"TOTAL_SHARES" NUMBER DEFAULT 0
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Table INTERACTIONS
--------------------------------------------------------

  CREATE TABLE "RM563326"."INTERACTIONS" 
   (	"INTERACTION_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE , 
	"POST_ID" NUMBER, 
	"USER_ID" NUMBER, 
	"TYPE" VARCHAR2(20 BYTE), 
	"CREATED_AT" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Table POSTS
--------------------------------------------------------

  CREATE TABLE "RM563326"."POSTS" 
   (	"POST_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE , 
	"USER_ID" NUMBER, 
	"TITLE" VARCHAR2(200 BYTE), 
	"CONTENT" CLOB, 
	"CREATED_AT" DATE DEFAULT SYSDATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" 
 LOB ("CONTENT") STORE AS SECUREFILE (
  TABLESPACE "TBSPC_ALUNOS" ENABLE STORAGE IN ROW CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) ;
--------------------------------------------------------
--  DDL for Table ROLES
--------------------------------------------------------

  CREATE TABLE "RM563326"."ROLES" 
   (	"ID" NUMBER, 
	"NAME" VARCHAR2(50 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Table USER_GROWTH_MONTHLY
--------------------------------------------------------

  CREATE TABLE "RM563326"."USER_GROWTH_MONTHLY" 
   (	"MONTH_YEAR" VARCHAR2(7 BYTE), 
	"TOTAL_USERS" NUMBER DEFAULT 0
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Table USER_ROLES
--------------------------------------------------------

  CREATE TABLE "RM563326"."USER_ROLES" 
   (	"USER_ID" NUMBER, 
	"ROLE_ID" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Table USERS
--------------------------------------------------------

  CREATE TABLE "RM563326"."USERS" 
   (	"USER_ID" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE , 
	"USER_NAME" VARCHAR2(100 BYTE), 
	"EMAIL" VARCHAR2(100 BYTE), 
	"CREATED_AT" DATE DEFAULT SYSDATE, 
	"USER_PASSWORD" VARCHAR2(100 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Table ALERTS
--------------------------------------------------------

  CREATE TABLE "RM563326"."ALERTS" 
   (	"ALERT_ID" NUMBER, 
	"ALERT_TYPE" VARCHAR2(50 BYTE), 
	"SEVERITY" VARCHAR2(20 BYTE), 
	"DETAILS" CLOB, 
	"CREATED_AT" DATE DEFAULT SYSDATE, 
	"REF_USER_ID" NUMBER, 
	"REF_POST_ID" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" 
 LOB ("DETAILS") STORE AS SECUREFILE (
  TABLESPACE "TBSPC_ALUNOS" ENABLE STORAGE IN ROW CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES 
  STORAGE(INITIAL 106496 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)) ;
--------------------------------------------------------
--  DDL for Index IDX_ENGAGEMENT_WEEKLY_START_END
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_ENGAGEMENT_WEEKLY_START_END" ON "RM563326"."ENGAGEMENT_WEEKLY" ("START_DATE", "END_DATE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_INTERACTIONS_POST
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_INTERACTIONS_POST" ON "RM563326"."INTERACTIONS" ("POST_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_INTERACTIONS_USER
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_INTERACTIONS_USER" ON "RM563326"."INTERACTIONS" ("USER_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_INTER_TYPE_DATE
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_INTER_TYPE_DATE" ON "RM563326"."INTERACTIONS" ("TYPE", "CREATED_AT") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_INTER_USER_POST_DATE
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_INTER_USER_POST_DATE" ON "RM563326"."INTERACTIONS" ("USER_ID", "POST_ID", "CREATED_AT") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_POSTS_USER
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_POSTS_USER" ON "RM563326"."POSTS" ("USER_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_POSTS_USER_CREATED_AT
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_POSTS_USER_CREATED_AT" ON "RM563326"."POSTS" ("USER_ID", "CREATED_AT") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_USERS_CREATED_AT
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_USERS_CREATED_AT" ON "RM563326"."USERS" ("CREATED_AT") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005729660
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005729660" ON "RM563326"."USERS" ("USER_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005729661
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005729661" ON "RM563326"."USERS" ("EMAIL") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005729663
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005729663" ON "RM563326"."POSTS" ("POST_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005729667
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005729667" ON "RM563326"."INTERACTIONS" ("INTERACTION_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005729673
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005729673" ON "RM563326"."ENGAGEMENT_WEEKLY" ("WEEK_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005729674
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005729674" ON "RM563326"."USER_GROWTH_MONTHLY" ("MONTH_YEAR") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005734204
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005734204" ON "RM563326"."ROLES" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005734205
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005734205" ON "RM563326"."USER_ROLES" ("USER_ID", "ROLE_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005745562
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005745562" ON "RM563326"."ALERTS" ("ALERT_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_IL0003381885C00004$$
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_IL0003381885C00004$$" ON "RM563326"."POSTS" (
  PCTFREE 10 INITRANS 2 MAXTRANS 255 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" 
  PARALLEL (DEGREE 0 INSTANCES 0) ;
--------------------------------------------------------
--  DDL for Index SYS_IL0003391532C00004$$
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_IL0003391532C00004$$" ON "RM563326"."ALERTS" (
  PCTFREE 10 INITRANS 2 MAXTRANS 255 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" 
  PARALLEL (DEGREE 0 INSTANCES 0) ;
--------------------------------------------------------
--  DDL for Index SYS_C005729673
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005729673" ON "RM563326"."ENGAGEMENT_WEEKLY" ("WEEK_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_ENGAGEMENT_WEEKLY_START_END
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_ENGAGEMENT_WEEKLY_START_END" ON "RM563326"."ENGAGEMENT_WEEKLY" ("START_DATE", "END_DATE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_INTER_TYPE_DATE
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_INTER_TYPE_DATE" ON "RM563326"."INTERACTIONS" ("TYPE", "CREATED_AT") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005729667
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005729667" ON "RM563326"."INTERACTIONS" ("INTERACTION_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_INTERACTIONS_POST
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_INTERACTIONS_POST" ON "RM563326"."INTERACTIONS" ("POST_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_INTERACTIONS_USER
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_INTERACTIONS_USER" ON "RM563326"."INTERACTIONS" ("USER_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_INTER_USER_POST_DATE
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_INTER_USER_POST_DATE" ON "RM563326"."INTERACTIONS" ("USER_ID", "POST_ID", "CREATED_AT") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005729663
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005729663" ON "RM563326"."POSTS" ("POST_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_POSTS_USER
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_POSTS_USER" ON "RM563326"."POSTS" ("USER_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_POSTS_USER_CREATED_AT
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_POSTS_USER_CREATED_AT" ON "RM563326"."POSTS" ("USER_ID", "CREATED_AT") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005734204
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005734204" ON "RM563326"."ROLES" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005729674
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005729674" ON "RM563326"."USER_GROWTH_MONTHLY" ("MONTH_YEAR") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005734205
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005734205" ON "RM563326"."USER_ROLES" ("USER_ID", "ROLE_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005729660
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005729660" ON "RM563326"."USERS" ("USER_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005729661
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005729661" ON "RM563326"."USERS" ("EMAIL") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index IDX_USERS_CREATED_AT
--------------------------------------------------------

  CREATE INDEX "RM563326"."IDX_USERS_CREATED_AT" ON "RM563326"."USERS" ("CREATED_AT") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Index SYS_C005745562
--------------------------------------------------------

  CREATE UNIQUE INDEX "RM563326"."SYS_C005745562" ON "RM563326"."ALERTS" ("ALERT_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS" ;
--------------------------------------------------------
--  DDL for Procedure PROC_EVALUATE_ENGAGEMENT_SENSORS
--------------------------------------------------------
set define off;

CREATE OR REPLACE EDITIONABLE PROCEDURE "RM563326"."PROC_EVALUATE_ENGAGEMENT_SENSORS" (
  p_from IN DATE,
  p_to IN DATE,
  p_multiplier IN NUMBER DEFAULT 3
) AS
  /*
    Procedure: PROC_EVALUATE_ENGAGEMENT_SENSORS
    Purpose : Evaluate interaction rates in a period and persist alerts when a spike is detected.
    Notes   : Uses a cursor to inspect the busiest day inside the window.
  */
  CURSOR c_daily_interactions IS
    SELECT TRUNC(created_at) AS interaction_day,
           COUNT(*) AS interactions_qtd
      FROM INTERACTIONS
     WHERE CREATED_AT >= p_from
       AND CREATED_AT < p_to
     GROUP BY TRUNC(created_at);

  v_current_rate NUMBER := 0;
  v_baseline NUMBER := 0;
  v_peak_date DATE;
  v_peak_total NUMBER := 0;
  v_details_vc2 VARCHAR2(32767);
  v_details_clob CLOB;
  v_alert_id NUMBER;
BEGIN
  IF p_from IS NULL OR p_to IS NULL OR p_to <= p_from THEN
    RAISE_APPLICATION_ERROR(-20001,'Janela invalida');
  END IF;

  SELECT NVL(COUNT(*),0)/GREATEST(((p_to - p_from) * 24),1)
    INTO v_current_rate
    FROM INTERACTIONS
   WHERE CREATED_AT >= p_from
     AND CREATED_AT < p_to;

  SELECT NVL(COUNT(*),0)/GREATEST(((p_from - (p_from - 7)) * 24),1)
    INTO v_baseline
    FROM INTERACTIONS
   WHERE CREATED_AT >= (p_from - 7)
     AND CREATED_AT < p_from;

  IF v_baseline = 0 AND v_current_rate > 0 THEN
    v_baseline := 0.1;
  END IF;

  -- Identify the busiest day in the analysed window.
  FOR daily_rec IN c_daily_interactions LOOP
    IF daily_rec.interactions_qtd > v_peak_total THEN
      v_peak_total := daily_rec.interactions_qtd;
      v_peak_date := daily_rec.interaction_day;
    END IF;
  END LOOP;

  IF v_current_rate >= p_multiplier * v_baseline THEN
    SELECT JSON_OBJECT(
             KEY 'from' VALUE TO_CHAR(p_from,'YYYY-MM-DD" "HH24:MI:SS'),
             KEY 'to' VALUE TO_CHAR(p_to,'YYYY-MM-DD" "HH24:MI:SS'),
             KEY 'currentRate' VALUE v_current_rate,
             KEY 'baseline' VALUE v_baseline,
             KEY 'multiplier' VALUE p_multiplier,
             KEY 'peakDay' VALUE TO_CHAR(v_peak_date,'YYYY-MM-DD'),
             KEY 'peakInteractions' VALUE v_peak_total
           )
      INTO v_details_vc2
      FROM dual;

    v_details_clob := TO_CLOB(v_details_vc2);
    v_alert_id := ALERTS_SEQ.NEXTVAL;

    INSERT INTO ALERTS(ALERT_ID,ALERT_TYPE,SEVERITY,DETAILS,CREATED_AT)
    VALUES(v_alert_id,'ENGAGEMENT_SPIKE','HIGH',v_details_clob,SYSDATE);
  END IF;
EXCEPTION
  WHEN OTHERS THEN
    v_details_clob := TO_CLOB('{'||
      '"error":"' || REPLACE(SUBSTR(SQLERRM,1,1000),'"','\"') || '",'||
      '"from":"' || TO_CHAR(p_from,'YYYY-MM-DD" "HH24:MI:SS') || '",'||
      '"to":"'   || TO_CHAR(p_to  ,'YYYY-MM-DD" "HH24:MI:SS') || '",'||
      '"multiplier":' || NVL(TO_CHAR(p_multiplier),'null') ||
      '}'
    );

    INSERT INTO ALERTS(ALERT_ID,ALERT_TYPE,SEVERITY,DETAILS,CREATED_AT)
    VALUES(ALERTS_SEQ.NEXTVAL,'ENGAGEMENT_SPIKE_ERROR','LOW',v_details_clob,SYSDATE);
END;
/
--------------------------------------------------------
--  DDL for Procedure PROC_USER_CONSUMPTION_REPORT
--------------------------------------------------------
set define off;

CREATE OR REPLACE EDITIONABLE PROCEDURE "RM563326"."PROC_USER_CONSUMPTION_REPORT" (
  p_user_id IN NUMBER,
  p_from IN DATE,
  p_to IN DATE,
  p_out OUT SYS_REFCURSOR
) AS
  /*
    Procedure: PROC_USER_CONSUMPTION_REPORT
    Purpose : Produce a consumption summary per user and period, returning a cursor for integration.
    Notes   : Aggregates interaction types inside a loop for clarity.
  */
  v_posts NUMBER := 0;
  v_interactions NUMBER := 0;
  v_likes NUMBER := 0;
  v_comments NUMBER := 0;
  v_shares NUMBER := 0;
  v_errmsg VARCHAR2(2000);
BEGIN
  IF p_user_id IS NULL OR p_from IS NULL OR p_to IS NULL OR p_to <= p_from THEN
    RAISE_APPLICATION_ERROR(-20002,'Parametros invalidos');
  END IF;

  SELECT COUNT(*)
    INTO v_posts
    FROM POSTS
   WHERE USER_ID = p_user_id
     AND CREATED_AT >= p_from
     AND CREATED_AT < p_to;

  FOR summary_rec IN (
    SELECT UPPER(TYPE) AS interaction_type,
           COUNT(*) AS total
      FROM INTERACTIONS
     WHERE USER_ID = p_user_id
       AND CREATED_AT >= p_from
       AND CREATED_AT < p_to
     GROUP BY UPPER(TYPE)
  ) LOOP
    CASE summary_rec.interaction_type
      WHEN 'LIKE' THEN
        v_likes := summary_rec.total;
      WHEN 'COMMENT' THEN
        v_comments := summary_rec.total;
      WHEN 'SHARE' THEN
        v_shares := summary_rec.total;
    END CASE;
  END LOOP;

  v_interactions := v_likes + v_comments + v_shares;

  OPEN p_out FOR
    SELECT p_user_id AS USER_ID,
           p_from AS PERIOD_FROM,
           p_to AS PERIOD_TO,
           v_posts AS POSTS_COUNT,
           v_interactions AS INTERACTIONS_COUNT,
           v_likes AS LIKES_COUNT,
           v_comments AS COMMENTS_COUNT,
           v_shares AS SHARES_COUNT,
           CASE WHEN v_interactions = 0 THEN 0 ELSE v_likes / v_interactions END AS LIKE_RATIO
      FROM dual;
EXCEPTION
  WHEN OTHERS THEN
    v_errmsg := REPLACE(SUBSTR(SQLERRM,1,2000),'"','\"');
    OPEN p_out FOR
      SELECT p_user_id AS USER_ID,
             p_from AS PERIOD_FROM,
             p_to AS PERIOD_TO,
             -1 AS POSTS_COUNT,
             -1 AS INTERACTIONS_COUNT,
             -1 AS LIKES_COUNT,
             -1 AS COMMENTS_COUNT,
             -1 AS SHARES_COUNT,
             0 AS LIKE_RATIO,
             v_errmsg AS ERROR_MSG
        FROM dual;
END;
/
--------------------------------------------------------
--  DDL for Function AVG_INTERACTIONS_PER_USER
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "RM563326"."AVG_INTERACTIONS_PER_USER"
RETURN NUMBER IS
  v_avg NUMBER := 0;
BEGIN
  -- Calculates the average number of interactions per user across the platform.
  SELECT AVG(interaction_count)
    INTO v_avg
    FROM (
      SELECT COUNT(*) AS interaction_count
        FROM INTERACTIONS
       GROUP BY USER_ID
    );

  RETURN NVL(v_avg, 0);
EXCEPTION
  WHEN NO_DATA_FOUND THEN
    RETURN 0;
  WHEN OTHERS THEN
    RETURN 0;
END;
/
--------------------------------------------------------
--  DDL for Function FN_AVG_ENGAGEMENT_PER_USER
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "RM563326"."FN_AVG_ENGAGEMENT_PER_USER"
RETURN NUMBER IS
  v_avg NUMBER := 0;
BEGIN
  -- Calculates engagement considering total interactions per user.
  SELECT AVG(cnt)
    INTO v_avg
    FROM (
      SELECT COUNT(*) AS cnt
        FROM INTERACTIONS
       GROUP BY USER_ID
    );

  RETURN NVL(v_avg, 0);
EXCEPTION
  WHEN NO_DATA_FOUND THEN
    RETURN 0;
  WHEN OTHERS THEN
    RETURN 0;
END;
/
--------------------------------------------------------
--  DDL for Function FN_AVG_NEW_USERS_PER_MONTH
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "RM563326"."FN_AVG_NEW_USERS_PER_MONTH" (p_months IN PLS_INTEGER DEFAULT 6)
RETURN NUMBER IS
  v_avg NUMBER := 0;
BEGIN
  -- Calculates the average of new users per month within the informed window.
  SELECT AVG(cnt)
    INTO v_avg
    FROM (
      SELECT COUNT(*) AS cnt
        FROM USERS
       WHERE CREATED_AT >= ADD_MONTHS(TRUNC(SYSDATE,'MM'), -p_months + 1)
       GROUP BY TRUNC(CREATED_AT,'MM')
    );

  RETURN NVL(v_avg, 0);
EXCEPTION
  WHEN NO_DATA_FOUND THEN
    RETURN 0;
  WHEN OTHERS THEN
    RETURN 0;
END;
/
--------------------------------------------------------
--  DDL for Function FN_DAILY_ENGAGEMENT
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "RM563326"."FN_DAILY_ENGAGEMENT" (p_day IN DATE)
RETURN NUMBER IS
  v_interactions NUMBER := 0;
  v_active_users NUMBER := 0;
BEGIN
  -- Engagement rate for a given day (interactions divided by active users).
  SELECT COUNT(*)
    INTO v_interactions
    FROM INTERACTIONS
   WHERE TRUNC(CREATED_AT) = TRUNC(p_day);

  SELECT COUNT(DISTINCT user_id)
    INTO v_active_users
    FROM (
      SELECT user_id
        FROM POSTS
       WHERE TRUNC(CREATED_AT) = TRUNC(p_day)
      UNION ALL
      SELECT user_id
        FROM INTERACTIONS
       WHERE TRUNC(CREATED_AT) = TRUNC(p_day)
    );

  IF v_active_users = 0 THEN
    RETURN 0;
  END IF;

  RETURN v_interactions / v_active_users;
EXCEPTION
  WHEN NO_DATA_FOUND THEN
    RETURN 0;
  WHEN OTHERS THEN
    RETURN 0;
END;
/
--------------------------------------------------------
--  DDL for Function FN_USER_SUMMARY_JSON
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "RM563326"."FN_USER_SUMMARY_JSON" (p_user_id IN NUMBER)
RETURN CLOB IS
  v_posts NUMBER := 0;
  v_interactions NUMBER := 0;
  v_likes NUMBER := 0;
  v_first_seen DATE;
  v_json_vc2 VARCHAR2(32767);
  v_json_clob CLOB;
BEGIN
  -- Returns a JSON payload summarising the user activity.
  SELECT MIN(CREATED_AT)
    INTO v_first_seen
    FROM USERS
   WHERE USER_ID = p_user_id;

  SELECT COUNT(*)
    INTO v_posts
    FROM POSTS
   WHERE USER_ID = p_user_id;

  SELECT COUNT(*)
    INTO v_interactions
    FROM INTERACTIONS
   WHERE USER_ID = p_user_id;

  SELECT COUNT(*)
    INTO v_likes
    FROM INTERACTIONS
   WHERE USER_ID = p_user_id
     AND UPPER(TYPE) = 'LIKE';

  SELECT JSON_OBJECT(
           KEY 'userId' VALUE p_user_id,
           KEY 'firstSeen' VALUE TO_CHAR(v_first_seen,'YYYY-MM-DD" "HH24:MI:SS'),
           KEY 'posts' VALUE v_posts,
           KEY 'interactions' VALUE v_interactions,
           KEY 'likes' VALUE v_likes
         )
    INTO v_json_vc2
    FROM dual;

  v_json_clob := TO_CLOB(v_json_vc2);
  RETURN v_json_clob;
EXCEPTION
  WHEN NO_DATA_FOUND THEN
    RETURN TO_CLOB('{"error":"USER_NOT_FOUND"}');
  WHEN OTHERS THEN
    RETURN TO_CLOB('{"error":"' || REPLACE(SUBSTR(SQLERRM,1,1000),'"','\"') || '"}');
END;
/
--------------------------------------------------------
--  Constraints for Table ENGAGEMENT_WEEKLY
--------------------------------------------------------

  ALTER TABLE "RM563326"."ENGAGEMENT_WEEKLY" MODIFY ("WEEK_ID" NOT NULL ENABLE);
  ALTER TABLE "RM563326"."ENGAGEMENT_WEEKLY" MODIFY ("START_DATE" NOT NULL ENABLE);
  ALTER TABLE "RM563326"."ENGAGEMENT_WEEKLY" MODIFY ("END_DATE" NOT NULL ENABLE);
  ALTER TABLE "RM563326"."ENGAGEMENT_WEEKLY" ADD PRIMARY KEY ("WEEK_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table INTERACTIONS
--------------------------------------------------------

  ALTER TABLE "RM563326"."INTERACTIONS" MODIFY ("INTERACTION_ID" NOT NULL ENABLE);
  ALTER TABLE "RM563326"."INTERACTIONS" ADD CHECK (TYPE IN ('LIKE', 'COMMENT', 'SHARE')) ENABLE;
  ALTER TABLE "RM563326"."INTERACTIONS" ADD PRIMARY KEY ("INTERACTION_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table POSTS
--------------------------------------------------------

  ALTER TABLE "RM563326"."POSTS" MODIFY ("POST_ID" NOT NULL ENABLE);
  ALTER TABLE "RM563326"."POSTS" ADD PRIMARY KEY ("POST_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ROLES
--------------------------------------------------------

  ALTER TABLE "RM563326"."ROLES" MODIFY ("NAME" NOT NULL ENABLE);
  ALTER TABLE "RM563326"."ROLES" ADD PRIMARY KEY ("ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table USER_GROWTH_MONTHLY
--------------------------------------------------------

  ALTER TABLE "RM563326"."USER_GROWTH_MONTHLY" ADD PRIMARY KEY ("MONTH_YEAR")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table USER_ROLES
--------------------------------------------------------

  ALTER TABLE "RM563326"."USER_ROLES" ADD PRIMARY KEY ("USER_ID", "ROLE_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table USERS
--------------------------------------------------------

  ALTER TABLE "RM563326"."USERS" MODIFY ("USER_ID" NOT NULL ENABLE);
  ALTER TABLE "RM563326"."USERS" MODIFY ("USER_NAME" NOT NULL ENABLE);
  ALTER TABLE "RM563326"."USERS" MODIFY ("EMAIL" NOT NULL ENABLE);
  ALTER TABLE "RM563326"."USERS" ADD PRIMARY KEY ("USER_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS"  ENABLE;
  ALTER TABLE "RM563326"."USERS" ADD UNIQUE ("EMAIL")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ALERTS
--------------------------------------------------------

  ALTER TABLE "RM563326"."ALERTS" MODIFY ("ALERT_TYPE" NOT NULL ENABLE);
  ALTER TABLE "RM563326"."ALERTS" MODIFY ("SEVERITY" NOT NULL ENABLE);
  ALTER TABLE "RM563326"."ALERTS" ADD PRIMARY KEY ("ALERT_ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "TBSPC_ALUNOS"  ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table INTERACTIONS
--------------------------------------------------------

  ALTER TABLE "RM563326"."INTERACTIONS" ADD FOREIGN KEY ("POST_ID")
	  REFERENCES "RM563326"."POSTS" ("POST_ID") ENABLE;
  ALTER TABLE "RM563326"."INTERACTIONS" ADD FOREIGN KEY ("USER_ID")
	  REFERENCES "RM563326"."USERS" ("USER_ID") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table POSTS
--------------------------------------------------------

  ALTER TABLE "RM563326"."POSTS" ADD FOREIGN KEY ("USER_ID")
	  REFERENCES "RM563326"."USERS" ("USER_ID") ENABLE;
--------------------------------------------------------
--  Ref Constraints for Table USER_ROLES
--------------------------------------------------------

  ALTER TABLE "RM563326"."USER_ROLES" ADD FOREIGN KEY ("USER_ID")
	  REFERENCES "RM563326"."USERS" ("USER_ID") ENABLE;
  ALTER TABLE "RM563326"."USER_ROLES" ADD FOREIGN KEY ("ROLE_ID")
	  REFERENCES "RM563326"."ROLES" ("ID") ENABLE;









